---
title: "Predictions"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(readxl)
library(FactoMineR)
library(MASS)
```

Load the Department equipment data:

```{r}
data_dpt <- read.csv("Data/Equipment1.csv")
```

Import useful Departmental indexes from INSEE to cross check with our data:

```{r}
chomage <- read_excel("Data/data_chomage.xlsx", skip =3) %>% 
  filter(!Code %in% c("971", "972", "973", "974", "976")) %>% 
  dplyr::select(-"Libellé")
colnames(chomage) [1] <- "dep"
View(chomage)

pauvreté <- read_excel("Data/data_pauvreté.xls", sheet = 2, skip=3)
colnames(pauvreté) [1] <- "dep"
colnames(pauvreté) [3] <- "Médiane du niveau de vie (euros)"
colnames(pauvreté) [5] <- "Taux de pauvreté (%)"
colnames(pauvreté) [4] <- "Delete1"
colnames(pauvreté) [6] <- "Delete2"
pauvreté <- pauvreté %>% 
  dplyr::select(-"Delete1", -"Delete2", -"Nom")
```

Merge indexes into Department Equipment dataframe to perform analyses:

```{r}
data_dpt <- data_dpt %>% 
  left_join(chomage, by = "dep")
data_dpt <- data_dpt %>% 
  left_join(pauvreté, by = "dep")

colnames(data_dpt) [22] <- "Chômage"
colnames(data_dpt) [23] <- "Niveau_de_vie"
colnames(data_dpt) [24] <- "Pauvreté"
data_dpt$Chômage <- as.numeric(data_dpt$Chômage)
data_dpt$dep <- as.numeric(data_dpt$dep)

View(data_dpt)
```

We create datasets for each Regression modelling that will be performed:

```{r}
data_dpt_chom <- data_dpt %>% 
  dplyr::select(-X, -dep, -Pauvreté, -Niveau_de_vie)

data_dpt_ndv <- data_dpt %>% 
  dplyr::select(-X, -dep, -Pauvreté, -Chômage)

data_dpt_pov <- data_dpt %>% 
  dplyr::select(-X, -dep, -Chômage, -Niveau_de_vie)
```

Let's perform regression modelling to identify the most useful variables to predict the various indexes:

```{r}
# Chômage
pred_chomage <- lm(Chômage~., data = data_dpt_chom)
pred_chomage_step <- step(pred_chomage, direction = "both")

pred_chomage_opt <- lm(formula(pred_chomage_step), data = data_dpt_chom)
summary(pred_chomage_opt)
```

```{r}
# Niveau de vie
pred_ndv <- lm(Niveau_de_vie ~., data = data_dpt_ndv)
pred_ndv_step <- step(pred_ndv, direction = "both")

pred_ndv_opt <- lm(formula(pred_ndv_step), data = data_dpt_ndv)
summary(pred_ndv_opt)
```

```{r}
# Pauvreté
pred_pov <- lm(Pauvreté ~., data = data_dpt_pov)
pred_pov_step <- step(pred_pov, direction = "both")

pred_pov_opt <- lm(formula(pred_pov_step), data = data_dpt_pov)
summary(pred_pov_opt)
```

